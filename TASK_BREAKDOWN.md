# 任务分解与时间评估

**项目**: WeChat Work 聊天机器人 - 登录与会话管理功能
**创建日期**: 2025-10-14
**总预计时间**: 约 25-32 工作小时（3-4 个工作日）

---

## Stage 1: 延迟登录模态框与登出功能

**阶段目标**: 实现延迟登录模式，用户点击发送时弹出登录模态框
**阶段预计时间**: 8-10 小时（1-1.5 个工作日）

### 任务清单

#### 1.1 创建登录模态框 UI
**预计时间**: 1.5 小时
**难度**: 简单
**依赖**: 无

**子任务**:
- [ ] 在 `/public/chat.html` 中添加登录模态框 HTML 结构（15分钟）
- [ ] 在 `/public/css/input.css` 中添加模态框样式（30分钟）
  - 半透明遮罩
  - 居中内容区
  - 企业微信品牌风格按钮
- [ ] 添加响应式设计样式（移动端适配）（30分钟）
- [ ] 运行 `npm run dev:css` 构建 Tailwind CSS（5分钟）
- [ ] 在浏览器中测试模态框显示效果（10分钟）

**交付物**: 登录模态框 HTML + CSS 完成，可手动显示/隐藏

---

#### 1.2 实现登录状态检查逻辑
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 后端已有 `/auth/session` 接口

**子任务**:
- [ ] 在 `/public/js/chat.js` 中创建 `checkLoginStatus()` 函数（20分钟）
  - 调用 `GET /auth/session` API
  - 返回 `{ authenticated, userId, userName }`
- [ ] 创建 `updateUIBasedOnLoginStatus(status)` 函数（20分钟）
  - 根据登录状态更新 UI（左下角用户区域）
- [ ] 修改发送按钮点击事件（20分钟）
  - 点击时先检查登录状态
  - 未登录显示模态框，已登录正常发送

**交付物**: 发送按钮点击时能正确检查登录状态

---

#### 1.3 实现登录模态框交互逻辑
**预计时间**: 2 小时
**难度**: 中等
**依赖**: 1.1, 1.2

**子任务**:
- [ ] 实现模态框显示/隐藏函数（30分钟）
  - `showLoginModal()` - 显示模态框
  - `hideLoginModal()` - 隐藏模态框
  - 点击遮罩或关闭按钮关闭模态框
- [ ] 实现"企业微信登录"按钮点击逻辑（45分钟）
  - 打开新窗口：`window.open('/auth/login', 'wechatLogin', '...')`
  - 主窗口轮询检查登录状态（每秒检查一次）
  - 检测到登录成功后关闭模态框
- [ ] 处理登录成功后的消息发送逻辑（30分钟）
  - 保存用户点击发送时的消息内容
  - 登录成功后自动继续发送
- [ ] 测试完整登录流程（15分钟）

**交付物**: 点击发送 → 弹出模态框 → 登录 → 自动发送消息

---

#### 1.4 调整企微 OAuth 回调逻辑
**预计时间**: 1.5 小时
**难度**: 中等
**依赖**: 1.3

**子任务**:
- [ ] 修改 `/server/routes/auth.js` 的 `/auth/callback` 路由（45分钟）
  - 检测是否从新窗口打开（检查 referer 或 query 参数）
  - 如果是新窗口，返回一个自动关闭的 HTML 页面
  - 页面中调用 `window.opener.postMessage` 通知父窗口
  - 自动关闭当前窗口 `window.close()`
- [ ] 在 `/public/js/chat.js` 中监听 `message` 事件（30分钟）
  - 接收子窗口发送的登录成功消息
  - 验证消息来源
  - 更新登录状态并关闭模态框
- [ ] 测试新窗口登录流程（15分钟）

**交付物**: 新窗口扫码登录成功后，主窗口能检测到并关闭模态框

---

#### 1.5 实现左下角用户区域 UI
**预计时间**: 1.5 小时
**难度**: 简单
**依赖**: 1.2

**子任务**:
- [ ] 在 `/public/chat.html` 中添加左下角用户区域 HTML（20分钟）
  - 未登录状态：登录按钮
  - 已登录状态：用户名/头像 + 下拉菜单
- [ ] 添加用户区域样式（30分钟）
  - 固定在左下角
  - 用户菜单样式（下拉动画）
- [ ] 实现用户区域交互逻辑（30分钟）
  - 未登录点击"登录"按钮弹出模态框
  - 已登录点击用户名弹出下拉菜单
  - 点击外部区域关闭菜单
- [ ] 测试不同登录状态下的 UI 显示（10分钟）

**交付物**: 左下角用户区域根据登录状态显示不同内容

---

#### 1.6 实现登出功能
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 1.5

**子任务**:
- [ ] 在 `/public/js/chat.js` 中实现 `logout()` 函数（30分钟）
  - 调用 `GET /auth/logout?redirect=json` API
  - 清除前端 localStorage
  - 更新 UI：左下角恢复为"登录"按钮
  - 隐藏侧边栏（如果已显示）
  - 清空当前聊天内容
- [ ] 调整后端 `/auth/logout` 路由（10分钟）
  - 确保支持 `redirect=json` 参数
  - 返回 JSON 响应而非重定向
- [ ] 测试登出流程（20分钟）
  - 测试登出后状态清除
  - 测试登出后重新登录

**交付物**: 用户可以成功登出，UI 恢复到未登录状态

---

#### 1.7 页面加载时初始化登录状态
**预计时间**: 0.5 小时
**难度**: 简单
**依赖**: 1.2, 1.5

**子任务**:
- [ ] 在 `/public/js/chat.js` 的 `DOMContentLoaded` 事件中（20分钟）
  - 调用 `checkLoginStatus()` 获取当前登录状态
  - 根据登录状态更新 UI
  - 如果已登录，显示用户信息和侧边栏
  - 如果未登录，显示登录按钮
- [ ] 测试页面刷新后的状态保持（10分钟）

**交付物**: 页面加载时自动检查登录状态并更新 UI

---

### Stage 1 测试与优化
**预计时间**: 1 小时
**难度**: 简单

**任务**:
- [ ] 完整流程测试（30分钟）
  - 未登录访问 → 输入消息 → 点击发送 → 弹出模态框
  - 点击登录 → 新窗口扫码 → 主窗口检测登录 → 自动发送消息
  - 登出 → UI 恢复未登录状态
  - 页面刷新 → 保持登录状态
- [ ] 修复发现的 bug（20分钟）
- [ ] 代码格式化和 lint（10分钟）
  - `npm run lint:fix`
  - `npm run format`

**交付物**: Stage 1 所有功能测试通过

---

## Stage 2: 侧边栏 UI 与基础布局

**阶段目标**: 实现侧边栏的 UI 结构和响应式布局
**阶段预计时间**: 5-6 小时（1 个工作日）

### 任务清单

#### 2.1 重构聊天页面布局
**预计时间**: 1.5 小时
**难度**: 中等
**依赖**: Stage 1 完成

**子任务**:
- [ ] 修改 `/public/chat.html` 的整体结构（45分钟）
  - 创建三栏布局：侧边栏 + 主内容区 + 右侧（预留）
  - 使用 Flexbox 或 Grid 布局
  - 添加必要的容器和类名
- [ ] 移动现有聊天区域内容到主内容区（30分钟）
- [ ] 调整现有 CSS 以适应新布局（15分钟）

**交付物**: 页面布局重构完成，侧边栏和主内容区分离

---

#### 2.2 实现桌面端侧边栏样式
**预计时间**: 1.5 小时
**难度**: 简单
**依赖**: 2.1

**子任务**:
- [ ] 在 `/public/css/input.css` 中添加侧边栏样式（45分钟）
  - 宽度 280px
  - 固定在左侧
  - 背景色和边框
  - 内部布局（顶部按钮 + 列表区域）
- [ ] 添加"新建会话"按钮样式（20分钟）
  - 固定在侧边栏顶部
  - 按钮样式和 hover 效果
- [ ] 添加会话列表容器样式（20分钟）
  - 可滚动区域
  - 滚动条样式
- [ ] 测试桌面端显示效果（5分钟）

**交付物**: 桌面端侧边栏样式完成

---

#### 2.3 实现移动端侧边栏（抽屉式）
**预计时间**: 2 小时
**难度**: 中等
**依赖**: 2.2

**子任务**:
- [ ] 在 `/public/chat.html` 中添加汉堡菜单按钮（15分钟）
  - 仅在移动端显示（< 768px）
  - 固定在左上角
- [ ] 实现侧边栏的展开/收起动画（45分钟）
  - 使用 CSS transition 或 Tailwind 动画类
  - 从左侧滑入/滑出
  - 添加半透明遮罩层
- [ ] 在 `/public/js/chat.js` 中实现侧边栏交互（45分钟）
  - 点击汉堡菜单展开侧边栏
  - 点击遮罩层关闭侧边栏
  - 选择会话后自动收起侧边栏（移动端）
- [ ] 测试移动端显示和交互（15分钟）

**交付物**: 移动端侧边栏可以正常展开/收起

---

#### 2.4 实现会话条目 UI
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 2.2

**子任务**:
- [ ] 设计会话条目 HTML 结构（20分钟）
  - 图标 + 标题 + 时间
  - 编辑和删除按钮
- [ ] 添加会话条目样式（30分钟）
  - 正常状态、hover 状态、激活状态
  - 编辑和删除按钮样式（仅 hover 时显示）
  - 省略号处理（标题过长）
- [ ] 添加 tooltip 提示（10分钟）
  - 鼠标悬停显示完整标题

**交付物**: 会话条目样式完成，可以渲染静态列表

---

### Stage 2 测试与优化
**预计时间**: 1 小时
**难度**: 简单

**任务**:
- [ ] 测试桌面端布局（20分钟）
  - 不同屏幕尺寸下的显示效果
  - 侧边栏宽度是否合适
- [ ] 测试移动端布局（20分钟）
  - 汉堡菜单是否正常工作
  - 抽屉式侧边栏动画是否流畅
- [ ] 测试会话条目样式（10分钟）
  - hover 效果是否正确
  - 省略号和 tooltip 是否正常
- [ ] 修复发现的样式问题（10分钟）

**交付物**: Stage 2 所有 UI 样式测试通过

---

## Stage 3: 会话管理功能集成

**阶段目标**: 对接 Coze API，实现会话的增删查改
**阶段预计时间**: 9-12 小时（1.5-2 个工作日）

### 任务清单

#### 3.1 研究 Coze SDK 会话管理 API
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 无

**子任务**:
- [ ] 查阅 Coze SDK v1.3.5 文档（30分钟）
  - `coze.conversations.list()` - 获取会话列表
  - `coze.conversations.create()` - 创建新会话
  - `coze.conversations.update()` - 更新会话（重命名）
  - `coze.conversations.messages.list()` - 获取会话消息
  - `coze.conversations.delete()` - 删除会话
- [ ] 在本地测试 API 调用（20分钟）
  - 使用 `SKIP_AUTH=true` 模式测试
  - 确认 API 响应数据结构
- [ ] 记录 API 用法和注意事项（10分钟）

**交付物**: Coze SDK 会话管理 API 用法文档

---

#### 3.2 实现后端会话管理 API - 获取会话列表
**预计时间**: 1.5 小时
**难度**: 中等
**依赖**: 3.1

**子任务**:
- [ ] 在 `/server/utils/cozeSDKAdapter.js` 中添加 `listConversations(userId)` 方法（45分钟）
  - 调用 Coze SDK 获取会话列表
  - 处理分页（如果需要）
  - 提取会话 ID、标题、更新时间
  - 如果会话没有标题，获取第一条用户消息作为标题
- [ ] 修改 `/server/routes/api.js` 中的 `GET /api/conversations` 端点（30分钟）
  - 调用 `cozeSDKAdapter.listConversations()`
  - 返回格式化的会话列表
  - 添加错误处理
- [ ] 测试 API 端点（15分钟）
  - 使用 Postman 或 curl 测试
  - 验证返回数据格式

**交付物**: `GET /api/conversations` API 可以正常返回会话列表

---

#### 3.3 实现后端会话管理 API - 创建会话
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 3.1

**子任务**:
- [ ] 在 `/server/utils/cozeSDKAdapter.js` 中添加 `createConversation(userId)` 方法（30分钟）
  - 调用 Coze SDK 创建会话
  - 返回新会话的 ID 和其他信息
- [ ] 修改 `/server/routes/api.js` 中的 `POST /api/conversations` 端点（20分钟）
  - 调用 `cozeSDKAdapter.createConversation()`
  - 返回新会话对象
  - 添加错误处理
- [ ] 测试 API 端点（10分钟）

**交付物**: `POST /api/conversations` API 可以创建新会话

---

#### 3.4 实现后端会话管理 API - 重命名会话
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 3.1

**子任务**:
- [ ] 在 `/server/utils/cozeSDKAdapter.js` 中添加 `updateConversation(conversationId, data)` 方法（30分钟）
  - 调用 Coze SDK 更新会话标题
  - 处理更新失败的情况
- [ ] 在 `/server/routes/api.js` 中新增 `PATCH /api/conversations/:id` 端点（20分钟）
  - 接收 `{ title: "新标题" }` 参数
  - 验证输入（非空，长度限制）
  - 调用 `cozeSDKAdapter.updateConversation()`
  - 添加错误处理
- [ ] 测试 API 端点（10分钟）

**交付物**: `PATCH /api/conversations/:id` API 可以重命名会话

---

#### 3.5 实现后端会话管理 API - 删除会话
**预计时间**: 0.5 小时
**难度**: 简单
**依赖**: 3.1

**子任务**:
- [ ] 在 `/server/utils/cozeSDKAdapter.js` 中添加 `deleteConversation(conversationId)` 方法（15分钟）
  - 调用 Coze SDK 删除会话
- [ ] 确认 `/server/routes/api.js` 中的 `DELETE /api/conversations/:id` 端点正常工作（10分钟）
  - 调用 `cozeSDKAdapter.deleteConversation()`
  - 添加错误处理
- [ ] 测试 API 端点（5分钟）

**交付物**: `DELETE /api/conversations/:id` API 可以删除会话

---

#### 3.6 实现后端会话管理 API - 获取会话消息
**预计时间**: 1 小时
**难度**: 中等
**依赖**: 3.1

**子任务**:
- [ ] 在 `/server/utils/cozeSDKAdapter.js` 中添加 `getConversationMessages(conversationId)` 方法（40分钟）
  - 调用 Coze SDK 获取会话历史消息
  - 处理分页（如果消息很多）
  - 格式化消息数据（区分用户消息和 AI 回复）
- [ ] 在 `/server/routes/api.js` 中新增 `GET /api/conversations/:id/messages` 端点（15分钟）
  - 调用 `cozeSDKAdapter.getConversationMessages()`
  - 返回消息列表
  - 添加错误处理
- [ ] 测试 API 端点（5分钟）

**交付物**: `GET /api/conversations/:id/messages` API 可以获取历史消息

---

#### 3.7 前端：创建会话管理器模块
**预计时间**: 1.5 小时
**难度**: 中等
**依赖**: 3.2-3.6

**子任务**:
- [ ] 创建 `/public/js/conversationManager.js` 文件（15分钟）
  - 定义会话管理器类或模块
- [ ] 实现 `loadConversations()` 方法（30分钟）
  - 调用 `GET /api/conversations` API
  - 返回会话列表
- [ ] 实现 `createConversation()` 方法（20分钟）
  - 调用 `POST /api/conversations` API
  - 返回新会话对象
- [ ] 实现 `updateConversation(id, title)` 方法（15分钟）
  - 调用 `PATCH /api/conversations/:id` API
- [ ] 实现 `deleteConversation(id)` 方法（15分钟）
  - 调用 `DELETE /api/conversations/:id` API
- [ ] 实现 `loadConversationMessages(id)` 方法（15分钟）
  - 调用 `GET /api/conversations/:id/messages` API

**交付物**: 会话管理器模块完成，可以调用所有后端 API

---

#### 3.8 前端：实现会话列表渲染
**预计时间**: 1.5 小时
**难度**: 中等
**依赖**: 3.7

**子任务**:
- [ ] 在 `/public/js/chat.js` 中实现 `renderConversationList(conversations)` 函数（45分钟）
  - 遍历会话列表
  - 生成会话条目 HTML
  - 渲染到侧边栏
  - 处理空会话列表情况
- [ ] 实现会话条目点击事件（30分钟）
  - 高亮当前会话
  - 触发 `switchConversation(id)` 函数
- [ ] 在页面加载时调用 `loadConversations()`（15分钟）
  - 仅在已登录状态下调用
  - 渲染会话列表到侧边栏

**交付物**: 页面加载时可以显示会话列表

---

#### 3.9 前端：实现新建会话功能
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 3.7, 3.8

**子任务**:
- [ ] 实现"新建会话"按钮点击事件（30分钟）
  - 调用 `conversationManager.createConversation()`
  - 将新会话添加到列表顶部
  - 切换到新会话
  - 清空聊天区域
  - 更新 localStorage 中的 `current_conversation_id`
- [ ] 处理创建失败的情况（10分钟）
  - 显示错误提示
- [ ] 测试新建会话流程（20分钟）

**交付物**: 点击"新建会话"可以创建并切换到新会话

---

#### 3.10 前端：实现切换会话功能
**预计时间**: 1.5 小时
**难度**: 中等
**依赖**: 3.7, 3.8

**子任务**:
- [ ] 实现 `switchConversation(conversationId)` 函数（45分钟）
  - 调用 `conversationManager.loadConversationMessages(id)`
  - 清空当前聊天区域
  - 渲染历史消息
  - 高亮当前会话
  - 更新 localStorage 中的 `current_conversation_id`
  - 移动端自动收起侧边栏
- [ ] 实现历史消息渲染函数（30分钟）
  - 区分用户消息和 AI 回复
  - 使用现有的消息样式
- [ ] 处理加载失败的情况（15分钟）
  - 显示加载动画
  - 显示错误提示

**交付物**: 点击会话条目可以加载历史消息

---

#### 3.11 前端：实现重命名会话功能
**预计时间**: 2 小时
**难度**: 中等
**依赖**: 3.7, 3.8

**子任务**:
- [ ] 实现编辑按钮点击事件（45分钟）
  - 将会话标题变为可编辑的 input
  - input 获得焦点并选中当前文本
  - 显示编辑模式样式
- [ ] 实现编辑模式的键盘事件（45分钟）
  - 回车键：保存并退出编辑模式
  - ESC 键：取消编辑，恢复原标题
  - blur 事件：失去焦点时保存
- [ ] 实现输入验证和保存逻辑（20分钟）
  - 验证输入非空
  - 验证长度不超过 100 个字符
  - 调用 `conversationManager.updateConversation()`
  - 更新侧边栏中的会话标题
  - 显示"重命名成功"提示
- [ ] 测试重命名流程（10分钟）

**交付物**: 点击编辑按钮可以重命名会话

---

#### 3.12 前端：实现删除会话功能
**预计时间**: 1 小时
**难度**: 简单
**依赖**: 3.7, 3.8

**子任务**:
- [ ] 实现删除按钮点击事件（30分钟）
  - 显示二次确认弹窗："确认删除此会话？"
  - 确认后调用 `conversationManager.deleteConversation(id)`
  - 从侧边栏移除该会话
  - 如果删除的是当前会话，切换到列表第一个会话
  - 如果没有其他会话，自动创建一个新会话
- [ ] 实现确认弹窗（20分钟）
  - 使用简单的 `window.confirm` 或自定义模态框
- [ ] 测试删除流程（10分钟）

**交付物**: 点击删除按钮可以删除会话

---

#### 3.13 集成到现有聊天功能
**预计时间**: 1 小时
**难度**: 中等
**依赖**: 3.9, 3.10

**子任务**:
- [ ] 修改 `/public/js/chat.js` 中的发送消息逻辑（30分钟）
  - 使用当前 `conversation_id` 发送消息
  - 如果没有当前会话，自动创建新会话
- [ ] 修改 `/server/services/chatService.js`（20分钟）
  - 确保使用正确的 `conversation_id`
  - 新消息自动更新会话的 `updated_at` 时间
- [ ] 实现会话列表自动排序（10分钟）
  - 发送消息后，将当前会话移到列表顶部

**交付物**: 发送消息时使用当前会话 ID，会话列表自动更新

---

### Stage 3 测试与优化
**预计时间**: 1.5 小时
**难度**: 中等

**任务**:
- [ ] 完整流程测试（45分钟）
  - 登录 → 显示会话列表
  - 新建会话 → 发送消息
  - 切换会话 → 加载历史消息
  - 重命名会话 → 验证保存成功
  - 删除会话 → 验证列表更新
- [ ] 边界情况测试（30分钟）
  - 空会话列表
  - 超长标题
  - 网络失败
  - 并发操作
- [ ] 修复发现的 bug（15分钟）

**交付物**: Stage 3 所有功能测试通过

---

## Stage 4: 交互优化与错误处理

**阶段目标**: 完善用户体验，增加加载状态和错误提示
**阶段预计时间**: 3-4 小时（0.5 个工作日）

### 任务清单

#### 4.1 实现加载状态指示
**预计时间**: 1 小时
**难度**: 简单
**依赖**: Stage 3 完成

**子任务**:
- [ ] 创建骨架屏组件（30分钟）
  - 会话列表加载时显示
  - 使用 Tailwind 的 `animate-pulse` 类
- [ ] 添加加载动画到异步操作（20分钟）
  - 切换会话时显示 loading
  - 重命名/删除会话时禁用按钮
- [ ] 测试加载状态显示（10分钟）

**交付物**: 所有异步操作都有加载状态提示

---

#### 4.2 实现错误处理和提示
**预计时间**: 1 小时
**难度**: 简单
**依赖**: Stage 3 完成

**子任务**:
- [ ] 创建 Toast 提示组件（30分钟）
  - 成功提示（绿色）
  - 错误提示（红色）
  - 信息提示（蓝色）
  - 自动消失（3秒后）
- [ ] 在所有 API 调用中添加错误处理（20分钟）
  - 网络错误显示"网络连接失败"
  - 401 错误弹出登录模态框
  - 其他错误显示"操作失败，请稍后重试"
- [ ] 测试错误提示（10分钟）

**交付物**: 错误情况有友好的提示信息

---

#### 4.3 UI 细节优化
**预计时间**: 1 小时
**难度**: 简单
**依赖**: Stage 2, Stage 3 完成

**子任务**:
- [ ] 实现会话标题 tooltip（15分钟）
  - 使用 HTML title 属性或自定义 tooltip
- [ ] 实现相对时间显示（30分钟）
  - "刚刚"、"5分钟前"、"2小时前"、"昨天"、"3天前"
  - 使用 `moment.js` 或自己实现
- [ ] 添加空会话列表提示（10分钟）
  - "暂无会话，点击新建会话开始聊天"
- [ ] 优化会话条目 hover 效果（5分钟）

**交付物**: UI 细节优化完成

---

#### 4.4 性能优化（可选）
**预计时间**: 1 小时
**难度**: 中等
**依赖**: Stage 3 完成

**子任务**:
- [ ] 实现重命名输入的防抖（20分钟）
  - 避免频繁调用 API
- [ ] 实现会话列表的虚拟滚动（30分钟）
  - 如果会话数量超过 50 个
  - 仅渲染可见区域的会话
- [ ] 测试性能优化效果（10分钟）

**交付物**: 性能优化完成（可选）

---

### Stage 4 最终测试
**预计时间**: 1 小时
**难度**: 简单

**任务**:
- [ ] 完整功能回归测试（30分钟）
  - 测试所有功能是否正常
  - 测试不同设备和浏览器
- [ ] 代码审查和清理（20分钟）
  - 移除 console.log
  - 移除未使用的代码
  - 添加必要的注释
- [ ] 代码格式化和 lint（10分钟）
  - `npm run lint:fix`
  - `npm run format`

**交付物**: 所有功能测试通过，代码质量达标

---

## 总结

### 时间估算汇总

| 阶段 | 任务数 | 预计时间 | 难度 |
|------|--------|----------|------|
| **Stage 1: 延迟登录** | 8 个任务 | 8-10 小时 | 中等 |
| **Stage 2: 侧边栏 UI** | 5 个任务 | 5-6 小时 | 简单-中等 |
| **Stage 3: 会话管理** | 14 个任务 | 9-12 小时 | 中等 |
| **Stage 4: 优化与测试** | 5 个任务 | 3-4 小时 | 简单 |
| **总计** | **32 个任务** | **25-32 小时** | - |

### 按工作日分配

- **Day 1** (8小时): Stage 1 完成
- **Day 2** (8小时): Stage 2 完成 + Stage 3 部分完成（任务 3.1-3.6）
- **Day 3** (8小时): Stage 3 完成（任务 3.7-3.13）
- **Day 4** (4小时): Stage 4 完成 + 最终测试

### 风险因素

1. **Coze API 不确定性**（高风险）
   - 如果 Coze API 不支持某些功能（如重命名），需要额外时间设计替代方案
   - **缓解措施**：优先完成 Stage 3.1（API 研究），确认可行性

2. **企微 OAuth 新窗口登录**（中风险）
   - 新窗口 postMessage 通信可能有跨域问题
   - **缓解措施**：尽早测试 Stage 1.4，确认可行性

3. **移动端适配**（中风险）
   - 移动端测试可能发现意外问题
   - **缓解措施**：Stage 2 完成后立即测试移动端

4. **时间估算偏差**（低风险）
   - 实际开发时间可能超出估算
   - **缓解措施**：每天复盘，及时调整计划

### 建议

1. **优先级排序**：
   - **必须完成**: Stage 1, Stage 2, Stage 3（核心功能）
   - **可选**: Stage 4.4（性能优化）

2. **并行开发**：
   - 后端 API（Stage 3.2-3.6）可以并行开发
   - 前端 UI（Stage 2）可以与后端 API 并行开发

3. **增量提交**：
   - 每完成一个小任务就 commit
   - 每完成一个 Stage 就创建一个 tag

4. **测试策略**：
   - 单元测试：后端 API 逻辑
   - 集成测试：前后端交互
   - E2E 测试：完整用户流程

---

## 下一步

请确认：
1. 时间估算是否合理？
2. 任务分解是否足够细致？
3. 是否需要调整优先级或删减某些功能？

确认后，我们可以开始实施 Stage 1！
